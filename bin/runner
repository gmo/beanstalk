#!/usr/bin/env php
<?php

use GMO\Beanstalk\Queue\Queue;

exec('"' . __DIR__ . '/findAutoloader"', $output);
$autoloader = $output[0];
/** @noinspection PhpIncludeInspection */
require_once $autoloader;

list(
	$cmd,
	$workerDir,
	$workerName,
	$host,
	$port,
) = $argv;

/** @var GMO\Beanstalk\Worker\WorkerInterface $worker */
$worker = new $workerName();
$runnerClass = $worker->getRunnerClass();
/** @var GMO\Beanstalk\Runner\RunnerInterface $runner */
$runner = new $runnerClass();
$runner->setup(new Queue($host, $port), $worker);
$runner->run();
